#!/usr/bin/make -f

%:
	dh $@

override_dh_clean:
	dh_clean --exclude=external/serialport/README.orig
	rm -rf vendor/bundle

override_dh_auto_configure:
	# Do nothing

override_dh_auto_build:
	# Build binary gems
	bundle install --without development test --path vendor/bundle --force
	echo "BUNDLE_FROZEN: '1'" >> .bundle/config

override_dh_install:
	dh_install --exclude=data/gui --exclude=LICENSE --exclude=LICENCE --exclude=LICENSE.txt
	echo "Note: The presence of this file tells msfupdate to rely on apt-get to install updates" > debian/metasploit-framework/usr/share/metasploit-framework/.apt
	# Hard code shebang for ruby scripts
	for binfile in $$(ls -d -1 debian/metasploit-framework/usr/share/metasploit-framework/tools/*.rb debian/metasploit-framework/usr/share/metasploit-framework/msf*); do \
	  sed -i $${binfile} -e '1,1s|#!.*ruby|#!/usr/share/metasploit-framework/ruby|' ; \
	done

override_dh_shlibdeps:
	dh_shlibdeps --exclude=/data/ --exclude=/modules/

override_dh_strip:
	dh_strip --exclude=/data/ --exclude=/modules/
